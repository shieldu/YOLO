# ShieldU
YOLO를 활용하여 사람 객체를 인지할 시 실시간으로 웹 페이지에 로그를 남기고 배경화면 색을 빨간색으로 변경시키는 홈 cctv 프로그램입니다.
<br>
<br>
<br>

## 기본 필수 설정 (모델 다운로드 및 테스트 코드)
```python
!pip install ultralytics

from ultralytics import YOLO

model = YOLO("yolov8s.pt")  # yolov8n.pt yolov8x.pt

result = model.predict(source="0", show=True)  # source="0"은 default 카메라를 뜻함.

print(result)
```
<br>

## yolov8n, yolov8s, yolov8x
| 모델 | 파라미터 수 | 추론 속도 | 정확도 (성능) | 사용 사례 |
| --- | --- | --- | --- | --- |
| **YOLOv8n** | 가장 적음 | 매우 빠름 | 상대적으로 낮음 | 경량 시스템, 실시간 추론, 모바일 장치 |
| **YOLOv8s** | 중간 | 빠름 | 중간 | 적당한 성능과 속도를 요구하는 경우 |
| **YOLOv8x** | 가장 많음 | 느림 | 가장 높음 | 고성능을 요구하는 복잡한 객체 탐지 작업 |
<br>
<br>

# 설명
이 코드는 YOLOv8 모델을 사용하여 실시간 침입 감지 시스템을 구현하는 Python 프로그램입니다. 웹캠을 통해 실시간으로 사람을 감지하고, Flask 서버를 사용하여 웹 페이지에서 침입 상태와 로그를 실시간으로 확인할 수 있습니다. 프로그램은 다음과 같은 방식으로 작동합니다:
<br>
<br>

## 1. 라이브러리 및 환경 설정
* threading: YOLO 감지와 Flask 서버를 각각 별도의 스레드에서 실행하기 위해 사용합니다.
* Flask: 간단한 웹 서버를 실행하여 사용자에게 침입 로그와 상태를 표시합니다.
* YOLO (ultralytics): YOLOv8 모델을 사용해 웹캠으로부터 받은 영상을 분석하여 사람을 탐지합니다.
* cv2 (OpenCV): 웹캠을 통해 실시간으로 영상을 가져오는 데 사용됩니다.
* winsound: 침입 감지 시 경고음을 내기 위해 사용됩니다 (Windows 환경 전용).
<br>
<br>

## 2. 침입 감지 로직
* 프로그램은 YOLOv8 모델을 사용하여 웹캠으로 들어오는 영상에서 사람(COCO 클래스 ID 0)을 탐지합니다.
* 사람이 탐지되면 다음과 같은 동작을 수행합니다:
* 침입 상태 플래그(intrusion_detected)가 True로 설정됩니다.
* 침입이 발생한 시간을 로그(intrusion_log)에 추가합니다.
* Windows 환경에서는 경고음을 재생합니다.
* 로그는 웹 페이지에서 실시간으로 업데이트됩니다.
<br>
<br>

## 3. Flask 서버 및 웹 페이지
* Flask 서버는 / 경로로 접속할 때 index 함수가 호출되어 웹 페이지를 렌더링합니다.
* 웹 페이지는 다음 정보를 실시간으로 표시합니다:
* 침입이 발생했을 때 페이지의 배경 색상이 흰색에서 빨간색으로 변경됩니다.
* 침입 로그가 실시간으로 업데이트됩니다.
* 두 개의 API 엔드포인트를 제공합니다:
* /intrusion_status: 현재 침입 상태를 JSON 형식으로 반환합니다.
* /get_logs: 현재까지의 침입 로그를 JSON 형식으로 반환합니다.
* 웹 페이지는 JavaScript를 사용하여 1초마다 침입 상태와 로그를 서버로부터 가져옵니다. 이를 통해 실시간으로 침입 여부를 확인하고 로그를 최신 상태로 유지할 수 있습니다.
<br>
<br>

## 4. 멀티스레딩을 통한 비동기 처리
* 이 프로그램은 두 가지 주요 작업(YOLO 감지 및 Flask 서버 실행)을 동시에 처리해야 하므로, threading 라이브러리를 사용하여 두 가지 작업을 별도의 스레드에서 실행합니다.
* detect_people 함수는 YOLO 모델을 사용한 사람 탐지를 담당하며, 웹캠에서 영상을 받아 YOLO 모델로 분석합니다.
* run_flask 함수는 Flask 서버를 실행하여 웹 페이지를 제공합니다.
<br>
<br>

## 5. 작동 흐름
* 프로그램이 실행되면 웹캠을 통해 실시간으로 영상을 입력받고, YOLO 모델을 사용하여 사람을 감지합니다.
* 사람이 감지되면 해당 시점에 대한 로그가 기록되며, 경고음이 울립니다.
* 동시에 Flask 서버가 실행되어 웹 페이지에서 실시간으로 침입 여부와 침입 로그를 확인할 수 있습니다.
* 웹 페이지는 1초마다 서버와 통신하여 최신 침입 상태와 로그를 반영합니다.
<br>
<br>

## 6. 개선점 및 확장 가능성
* 경고 방식 확장: 경고음을 이메일 또는 메시지 알림 등 다른 방식으로 확장할 수 있습니다.
* 모바일 지원: Flask 서버를 인터넷에 연결하거나 모바일 친화적으로 개선하여 스마트폰에서 실시간으로 침입 상태를 확인할 수 있습니다.
<br>
<br>

# 결론
이 프로그램은 YOLOv8 모델을 사용하여 실시간으로 사람을 감지하고, Flask 서버를 통해 웹 페이지에서 침입 상태와 로그를 실시간으로 확인할 수 있는 침입 감지 시스템입니다. 멀티스레딩을 사용하여 YOLO 감지와 Flask 서버를 동시에 실행하며, 사람을 감지하면 경고음을 울리고, 웹 페이지에 로그를 기록합니다.
